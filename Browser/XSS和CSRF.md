# 什么是 XSS 攻击

XSS 全称是 Cross Site Scripting，为了与“CSS”区分开来，故简称 XSS，翻译过来就是“跨站脚本”。XSS 攻击是指黑客往 **HTML 文件中或者 DOM 中注入恶意脚本**，从而在用户浏览页面时利用注入的恶意脚本对用户实施攻击的一种手段。

### 恶意脚本都能做哪些事情。

- 可以窃取 Cookie 信息。恶意 JavaScript 可以通过“document.cookie”获取 Cookie 信息，然后通过 XMLHttpRequest 或者 Fetch 加上 CORS 功能将数据发送给恶意服务器；恶意服务器拿到用户的 Cookie 信息之后，就可以在其他电脑上模拟用户的登录，然后进行转账等操作。可以监听用户行为。

- 恶意 JavaScript 可以使用“addEventListener”接口来监听键盘事件，比如可以获取用户输入的信用卡等信息，将其发送到恶意服务器。黑客掌握了这些信息之后，又可以做很多违法的事情。

- 可以通过修改 DOM 伪造假的登录窗口，用来欺骗用户输入用户名和密码等信息。

- 还可以在页面内生成浮窗广告，这些广告会严重地影响用户体验。



## 恶意脚本是怎么注入的

1. 存储型 XSS 攻击
   1. 首先黑客利用站点漏洞将一段恶意 JavaScript 代码提交到网站的数据库中；
   2. 然后用户向网站请求包含了恶意 JavaScript 脚本的页面；
   3. 当用户浏览该页面的时候，恶意脚本就会将用户的 Cookie 信息等数据上传到服务器。

2. 反射型 XSS 攻击

> Web 服务器不会存储反射型 XSS 攻击的恶意脚本，这是和存储型 XSS 攻击不同的地方。

3. 基于 DOM 的 XSS 攻击

   基于 DOM 的 XSS 攻击是不牵涉到页面 Web 服务器的。具体来讲，黑客通过各种手段将恶意脚本注入用户的页面中，比如通过网络劫持在页面传输过程中修改 HTML 页面的内容，这种劫持类型很多，有通过 WiFi 路由器劫持的，有通过本地恶意软件来劫持的，它们的共同点是在 Web 资源传输过程或者在用户使用页面的过程中修改 Web 页面的数据。

## 如何阻止 XSS 攻击

我们知道存储型 XSS 攻击和反射型 XSS 攻击都是需要经过 Web 服务器来处理的，因此可以认为这两种类型的漏洞是服务端的安全漏洞。而基于 DOM 的 XSS 攻击全部都是在浏览器端完成的，因此**基于 DOM 的 XSS 攻击是属于前端的安全漏洞**。

但无论是何种类型的 XSS 攻击，它们都有一个共同点，那就是**首先往浏览器中注入恶意脚本**，**然后再通过恶意脚本将用户信息发送至黑客部署的恶意服务器上**。



### 常用的阻止 XSS 攻击的策略。

1. 在服务器端将一些关键的字符进行过滤和转码

   - 过滤

   ```javascript
   code:<script>alert(' you are under attack')</script>
   ```

     经过过滤后

   ```
   code: 
   ```

   - 转码

   ```javascript
   code:&lt;script&gt;alert(&#39;你被xss攻击了&#39;)&lt;/script&gt;
   ```

   

2. 充分利用 CSP 

    实施严格的 CSP 可以有效地防范 XSS 攻击，具体来讲 CSP 有如下几个功能：
    
    